# Anchor Graph Visualization Tool

This is an interactive web-based tool for visualizing anchor graph generated by giraffe mapping followed by anchor generation methods. It uses `Cytoscape.js` to render the graph.

## How to Render?
This tool uses python's built-in HTTP server (configured using `server.py`) to serve the files. To run the server: -

1.  **Navigate to the project directory:**
    Open your terminal and change into the `visualization` directory where the `index.html` file is located.
    ```sh
    cd visualization
    ```

2.  **Start the Python web server:**
    Run the following command in your terminal.
    ```sh
    python3 -m http.server 8000
    ```
    This will start a web server on port 8000.

3.  **Open the tool in your browser:**
    Open your web browser (like Chrome or Firefox) and navigate to:
    [http://localhost:8000](http://localhost:8000)

The anchor graph visualization should now load and render on the page.

---

## Required Input Files

The visualization relies on three JSON files (`snarl_to_anchors_dictionary.json`, `anchors_read_info.json` and `read_info.json`) being present in the `visualization/` directory. These files can be generated by running `prep_data_viz.py`. 

It takes 2 required inputs - 1. `subgraph.anchors.json.extended.jsonl` and 2. `subgraph.anchors.json.subgraph.sizes.extended.tsv`

```
usage: prep_data_viz.py [-h] --input-json INPUT_JSON --input-tsv INPUT_TSV --output-json OUTPUT_JSON --snarl-output SNARL_OUTPUT --connectivity-output
                        CONNECTIVITY_OUTPUT --read-metadata-output READ_METADATA_OUTPUT

Transform raw anchor data and generate snarl, connectivity, and read metadata files for visualization.

options:
  -h, --help            show this help message and exit
  --input-json INPUT_JSON
                        Path to the *initial* list-based JSON file with anchor and read data.
  --input-tsv INPUT_TSV
                        Path to the TSV file mapping anchor IDs to snarl IDs (must contain a header).
  --output-json OUTPUT_JSON
                        Path for the output JSON file with transformed anchor data.
  --snarl-output SNARL_OUTPUT
                        Path for the output JSON file mapping snarls to anchors.
  --connectivity-output CONNECTIVITY_OUTPUT
                        Path for the output JSON file showing anchor connectivity.
  --read-metadata-output READ_METADATA_OUTPUT
                        Path for the output JSON file with metadata for each read.
```

## Project File Descriptions

The core logic of the tool is contained in three files:

| File Name     | Description                                                                                                                                                                                                                                                        |
| ------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `index.html`  | The main HTML file. It defines the structure of the page, including the container for the graph (`<div id="cy">`) and all user interface controls (buttons, inputs for searching, etc.). It also imports the required JavaScript libraries and the main `script.js`. |
| `style.css`   | The stylesheet for the application. It contains all the CSS rules for styling the page layout, the control panel, and the info panel. It also provides some base styling for tooltips.                                                                                   |
| `script.js`   | It contains all the JavaScript logic to: <br> - Load and parse the three input JSON files. <br> - Process the data to build the node and edge lists. <br> - Initialize the Cytoscape.js engine. <br> - Define the complex, two-stage physics-based layout (`cose` followed by `cola`). <br> - Handle all user interactions, such as clicking on nodes and edges, highlighting read journeys, and managing UI controls. |

---

## Features and Interactivity

-   **Physics-Based Layout:** The graph uses a `cose` and `cola` layout to automatically arrange nodes, minimizing edge crossings.
-   **Data-Driven Edge Lengths:** The distance between nodes is inversely proportional to their connection weight (shared reads), pulling strongly connected nodes closer together.
-   **Node/Edge Information:** Clicking on a node or an edge will open a new browser tab with a detailed table of the underlying data (reads, strands, etc.).
-   **Read Journey Highlighting:** Enter a read ID and click "Visualize" to highlight the path of that specific read through the graph.
-   **Interactive Controls:** Zoom with the mouse wheel, pan by dragging the background, and move nodes by dragging them.

